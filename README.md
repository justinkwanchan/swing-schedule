# MontrealSwingCalendar

## Data Modelling

We use a Single Table DynamoDB Design here. The primary key here is the specific data silo (Uers, Events in this scenario). Here is the expected data-access patterns:

| Access Pattern                   | Type   | Keys                           | Filters       | Ordering  |
| -------------------------------- | ------ | ------------------------------ | ------------- | --------- |
| Create Event                     | Single | EVENT#{uuid}/WEEKOF#{datetime} | NA            | NA        |
| Query Event                      | Single | EVENT#{uuid}/WEEKOF#{datetime} | NA            | NA        |
| Query Events by User             | Multi  | email/EVENT#{uuid}             | USERS GSI     | NA        |
| Query Event Occurences by Event  | Multi  | EVENT#{uuid}/WEEKOF#{datetime} | NA            | WEEKOF    |
| Update Event                     | Single | EVENT#{uuid}/WEEKOF#{datetime} | NA            | NA        |
| Update Event Occurences by Event | Multi  | EVENT#{uuid}/WEEKOF#{datetime} | NA            | NA        |
| Query Events By WeekOf           | Multi  | WEEKOF#{datetime}/EVENT#{uuid} | WEEKOF GSI    | NA        |
| Create User                      | Single | USER#{email}/INFORMATION       | NA            | NA        |
| Query User                       | Single | USER#{email}/INFORMATION       | NA            | NA        |

Thus, we can arrive at the DynamoDB Design:

| PK           | SK                |
| ------------ | ----------------- |
| EVENT#{uuid} | WEEKOF#{datetime} |
| USER#{email} | INFORMATION       |

With the following LSIs/GSIs

| PK                | SK           | Type |
| ----------------- | ------------ | ---- |
| user              | EVENT#{uuid} | GSI  |
| WEEKOF#{datetime} | EVENT{uuid}  | GSI  |


## API

There are the following endpoints:
- `/createEvent`
- `/queryEvent`
- `/queryOccurrencesByEvent`
- `/queryEventsByWeekOf`
- `/queryEventsByUser`
- `/updateEvent`
- `/updateOccurrencesByEvent`

The fields to send in general for the `/createEvent` endpoint and the update endpoints:
- `id` (uuid, created by the FE)
- `eventName` (string)
- `startDateTime` (datetime)
- `endDateTime` (datetime)
- `repeated` (boolean)
- `repeatedUntil` (datetime)
- `cancelled` (boolean)
- `weekOf` (datetime)
- `details` (string)
- `location` (string)
- `price` (string)
- `user` (email)

Note, we only support weekly repeating for the `repeatedUntil`. Similar to the `id` field, the `weekOf` field will be generated by the FE using a Monday at midnight as the start of the week. Note, times should be in as ISO 8601 String (use the `dayjs` library).

For querying:
- `/queryEvent` requires `id` and `weekOf`
- `/queryOccurrencesByEvent` requires `id`
- `/queryEventsByWeekOf` requires `weekOf`
- `/queryEventsByUser` requires `user`

Lastly, if updating an event causes it to be moved to a different week, please use `/createEvent`, and use `/updateEvent` to cancel the previous event. We have to do this since we use `weekOf` as part of the standard sort key.

In regards to users, there are two endpoints:
- `/signup`
- `/login`

Which both take the following fields:
- `email`
- `password`

The base URL for these endpoints is: `https://58vzjkrur5.execute-api.us-east-1.amazonaws.com/dev/`